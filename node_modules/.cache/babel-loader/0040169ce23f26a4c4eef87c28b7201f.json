{"ast":null,"code":"var _jsxFileName = \"/home/abdulhayan/stack/mern/react/practice/vidly/src/common/MovieForm/MovieForm.jsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useState } from \"react\";\nimport InputFeild from \"./Input\";\nimport InputFeildSelect from \"./Input_select\";\nimport Joi from \"joi-browser\";\nimport { getGenres } from '../fakeGenreService';\nimport { useEffect } from \"react\";\nimport { getMovie, saveMovie } from \"../../Movies/fakeMovieService\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst MovieForm = () => {\n  _s();\n\n  const [data, setData] = useState({\n    title: \"\",\n    genreId: \"\",\n    numberInStock: \"\",\n    dailyRentalRate: \"\"\n  });\n  const [errors, setErrors] = useState({});\n  const [genres, setGenres] = useState([]);\n  const movie = useParams().movie;\n  console.log(movie);\n  const naviage = useNavigate();\n  useEffect(() => {\n    const newGeners = getGenres();\n    setGenres(newGeners);\n    console.log(movie);\n    if (movie === \"new\") return;\n    const gottenMovie = getMovie(movie);\n    console.log(gottenMovie);\n    if (!gottenMovie) return naviage(\"/not-found\", {\n      replace: true\n    });\n    setData(mapToViewModel(gottenMovie));\n  }, []);\n\n  const mapToViewModel = movie => {\n    return {\n      title: movie.title,\n      genreId: movie.genre._id,\n      numberInStock: movie.numberInStock,\n      dailyRentalRate: movie.dailyRentalRate,\n      favourite: false\n    };\n  };\n\n  const handleForm = event => {\n    event.preventDefault();\n    const errors = handleErrors();\n    setErrors(errors || {});\n    console.log(errors);\n    if (errors) return;\n    doSubmit();\n  };\n\n  const handleErrors = () => {\n    const {\n      error\n    } = Joi.validate(data, schema, {\n      abortEarly: false\n    });\n    if (!error) return null;\n    const errors = {};\n\n    for (let item of error.details) {\n      errors[item.path[0]] = item.message;\n    }\n\n    return errors;\n  };\n\n  const handleOnChange = _ref => {\n    let {\n      currentTarget: input\n    } = _ref;\n    let newErrors = { ...errors\n    };\n    let newMessage = handleOnSaveErrors(input);\n    if (newMessage) newErrors[input.name] = newMessage;else delete newErrors[input.name];\n    let value = input.value;\n    let newData = { ...data\n    };\n    newData[input.name] = value;\n    setData(newData);\n    setErrors(newErrors);\n  };\n\n  const handleOnSaveErrors = _ref2 => {\n    let {\n      name,\n      value\n    } = _ref2;\n    const toBeValidate = {\n      [name]: value\n    };\n    const OnSaveSchema = {\n      [name]: schema[name]\n    };\n    const {\n      error\n    } = Joi.validate(toBeValidate, OnSaveSchema);\n    console.log(error);\n    return error ? error.details[0].message : null;\n  };\n\n  const schema = {\n    title: Joi.string().required().label(\"Title\"),\n    genreId: Joi.string().required().label(\"Genre\"),\n    numberInStock: Joi.number().integer().min(0).max(100).required().label(\"Number in Stock\"),\n    dailyRentalRate: Joi.number().min(0).max(10).required().label(\"Rate\")\n  };\n\n  const doSubmit = () => {\n    let newData = data;\n    newData.favourite = false;\n    console.log(newData);\n    saveMovie(newData);\n    naviage(\"/movies\");\n  };\n\n  const renderButton = label => {\n    return /*#__PURE__*/_jsxDEV(\"button\", {\n      disabled: handleErrors(),\n      onClick: handleForm,\n      className: \"btn btn-primary\",\n      children: label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 11\n    }, this);\n  };\n\n  const renderInput = (name, label, type) => {\n    return /*#__PURE__*/_jsxDEV(InputFeild, {\n      name: name,\n      label: label,\n      value: data[name],\n      onChange: handleOnChange,\n      type: type,\n      error: errors[name]\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 11\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container mt-5\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: [\"Movie Form\", movie]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleForm,\n      children: [renderInput(\"title\", \"Title\", \"text\"), /*#__PURE__*/_jsxDEV(InputFeildSelect, {\n        name: \"genreId\",\n        value: data.genreId,\n        onChange: handleOnChange,\n        error: errors.genre,\n        options: genres\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 11\n      }, this), renderInput(\"numberInStock\", \"Number In Stock\", \"number\"), renderInput(\"dailyRentalRate\", \"Rate\", \"number\"), renderButton(\"Save\")]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 137,\n    columnNumber: 5\n  }, this);\n};\n\n_s(MovieForm, \"ystoaxJ0P4HfrD0w2dIyUwZ/itc=\", false, function () {\n  return [useParams, useNavigate];\n});\n\n_c = MovieForm;\nexport default MovieForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"MovieForm\");","map":{"version":3,"names":["React","useParams","useNavigate","useState","InputFeild","InputFeildSelect","Joi","getGenres","useEffect","getMovie","saveMovie","MovieForm","data","setData","title","genreId","numberInStock","dailyRentalRate","errors","setErrors","genres","setGenres","movie","console","log","naviage","newGeners","gottenMovie","replace","mapToViewModel","genre","_id","favourite","handleForm","event","preventDefault","handleErrors","doSubmit","error","validate","schema","abortEarly","item","details","path","message","handleOnChange","currentTarget","input","newErrors","newMessage","handleOnSaveErrors","name","value","newData","toBeValidate","OnSaveSchema","string","required","label","number","integer","min","max","renderButton","renderInput","type"],"sources":["/home/abdulhayan/stack/mern/react/practice/vidly/src/common/MovieForm/MovieForm.jsx"],"sourcesContent":["import React from \"react\";\nimport { useParams,useNavigate } from \"react-router-dom\";\nimport { useState } from \"react\";\nimport InputFeild from \"./Input\";\nimport InputFeildSelect from \"./Input_select\";\nimport Joi from \"joi-browser\";\nimport { getGenres } from '../fakeGenreService';\nimport { useEffect } from \"react\";\nimport { getMovie, saveMovie } from \"../../Movies/fakeMovieService\";\n\n\n\nconst MovieForm = () => {\n\n  const [data, setData] = useState({ title: \"\", genreId: \"\", numberInStock: \"\", dailyRentalRate: \"\" })\n  const [errors, setErrors] = useState({})\n  const [genres, setGenres] = useState([])  \n  const movie = useParams().movie;\n\n  console.log(movie);\n  const naviage = useNavigate();\n\n\n  useEffect(() => {\n    const newGeners = getGenres();\n    setGenres(newGeners);\n\n    console.log(movie);\n    if (movie === \"new\") return;\n    const gottenMovie = getMovie(movie);\n\n    console.log(gottenMovie);\n\n    if (!gottenMovie) return naviage(\"/not-found\", {replace: true});\n\n    setData(mapToViewModel(gottenMovie));\n\n  },[]);\n\n  const mapToViewModel = (movie) => {\n    return {\n      title: movie.title,\n      genreId: movie.genre._id,\n      numberInStock: movie.numberInStock,\n      dailyRentalRate: movie.dailyRentalRate,\n      favourite: false\n    }\n  }\n\n  const handleForm = (event) => {\n    event.preventDefault();\n    const errors = handleErrors();\n    setErrors(errors || {});\n    console.log(errors);\n    if (errors) return;\n    doSubmit();\n  };\n \n  const handleErrors = () => {\n        const { error } = Joi.validate(data, schema, {\n          abortEarly: false,\n        });\n        if (!error) return null;\n        const errors = {};\n        for (let item of error.details) {\n          errors[item.path[0]] = item.message;\n        }\n        return errors;\n      };\n\n      const handleOnChange = ({ currentTarget: input }) => {\n        let newErrors = { ...errors };\n        let newMessage = handleOnSaveErrors(input);\n        if (newMessage) newErrors[input.name] = newMessage;\n        else delete newErrors[input.name];\n        let value = input.value;\n        let newData = { ...data };\n        newData[input.name] = value;\n        setData(newData);\n        setErrors(newErrors); \n      };\n    \n\n      const handleOnSaveErrors = ({ name, value }) => {\n        const toBeValidate = { [name]: value };\n        const OnSaveSchema = { [name]: schema[name] };\n        const { error } = Joi.validate(toBeValidate, OnSaveSchema);\n        console.log(error);\n        return error ? error.details[0].message : null;\n      };\n      const schema = {  \n        title: Joi.string().required().label(\"Title\"),\n        genreId: Joi.string().required().label(\"Genre\"),\n        numberInStock: Joi.number()\n          .integer()\n          .min(0)\n          .max(100)\n          .required()\n          .label(\"Number in Stock\"),\n        dailyRentalRate: Joi.number().min(0).max(10).required().label(\"Rate\"),\n      };\n    \n     const  doSubmit = () => {\n        let newData = data;\n        newData.favourite = false;\n      console.log(newData);\n        saveMovie(newData);\n        naviage(\"/movies\")\n      };\n    \n      const renderButton = (label) => {\n        return (\n          <button\n            disabled={handleErrors()}\n            onClick={handleForm}\n            className=\"btn btn-primary\"\n          >\n            {label}\n          </button>\n        );\n      };\n    \n      const renderInput = (name, label, type) => {\n        return (\n          <InputFeild\n            name={name}\n            label={label}\n            value={data[name]}\n            onChange={handleOnChange}\n            type={type}\n            error={errors[name]}\n          />\n        );\n      };\n    \n  return (\n    <div className=\"container mt-5\">\n        <h1>Movie Form{movie}</h1>\n        <form onSubmit={handleForm}>\n          {renderInput(\"title\", \"Title\", \"text\")}\n          <InputFeildSelect name=\"genreId\" value={data.genreId} onChange={handleOnChange} error={errors.genre} options={genres} />\n          {renderInput(\"numberInStock\", \"Number In Stock\", \"number\")}\n          {renderInput(\"dailyRentalRate\", \"Rate\", \"number\")}\n          {renderButton(\"Save\")}\n        </form>\n      </div>\n  );\n};\n\nexport default MovieForm;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}